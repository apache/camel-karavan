# ---------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ---------------------------------------------------------------------------
apiVersion: camel.apache.org/v1alpha1
kind: Kamelet
metadata:
  name: dns-dig-action
  annotations:
    camel.apache.org/kamelet.support.level: "Preview"
    camel.apache.org/catalog.version: "0.8.1"
    camel.apache.org/kamelet.icon: "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTIyLjg3OSAxMjIuODgxIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjIuODc5IDEyMi44ODEiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGQ9Ik0xMDkuNDY3LDg5LjUwNWMwLjE4MiwwLDAuMzU5LDAuMDE5LDAuNTMxLDAuMDUzYzEuMTQ2LTEuOTk4LDIuMTkxLTQuMDk1LDMuMTM3LTYuMjg3IGMwLjAxOC0wLjA0MywwLjAzNy0wLjA4NSwwLjA1OS0wLjEyN2MxLjQxOC0zLjM0NiwyLjQ4OC02LjgxOSwzLjIwOS0xMC40MmMwLjE5My0wLjk2MSwwLjM1OS0xLjkzMSwwLjUtMi45MDggYzAuNjM5LTMuOTUzLDAuODAzLTcuOTcsMC40ODItMTIuMDUyYy0wLjE2LTIuNTkxLTAuNDg4LTUuMTI2LTAuOTgyLTcuNjA1Yy0wLjczLTMuNjQ2LTEuODE4LTcuMTY1LTMuMjY2LTEwLjU0OWwtMC4wMDIsMC4wMDIgbC0zLjEwNy02LjIzM2wwLDBsLTAuMjgzLTAuMzM2SDEzLjA0N2wtMC4xOTUsMC4zMzZjLTEuMTM2LDEuOTgyLTIuMTcsNC4wNjEtMy4xMDUsNi4yMzRjLTAuMDE5LDAuMDQzLTAuMDM5LDAuMDg2LTAuMDU5LDAuMTI3IGMtMC44NzgsMi4wNzEtMS42MjIsNC4xOS0yLjIzMyw2LjM1OGMtMi41NzIsOC40NDgtMi45NzIsMTYuODk1LTEuMjE3LDI1LjM0MmMwLjA3NiwwLjQzLDAuMTU1LDAuODU4LDAuMjQxLDEuMjg1IGMwLjcyOSwzLjY0NiwxLjgxOCw3LjE2NCwzLjI2NCwxMC41NDlsMC4wMDQtMC4wMDFjMC45MzUsMi4xNzIsMS45NjksNC4yNTEsMy4xMDUsNi4yMzNsMCwwIEM0NS4wODgsODkuNTA1LDc3LjI3Nyw4OS41MDUsMTA5LjQ2Nyw4OS41MDVMMTA5LjQ2Nyw4OS41MDVMMTA5LjQ2Nyw4OS41MDV6IE0zMi4yNjksNDUuODE2YzQuNTQ4LDAsOC4wMzksMS4yMzMsMTAuNDcyLDMuNjk3IGMyLjQzMiwyLjQ2NCwzLjY0OSw2LjAxOSwzLjY0OSwxMC42NjNjMCw1LjUwMi0xLjQxNiw5LjczMi00LjI0NiwxMi42OWMtMi44MzEsMi45NTctNi44ODUsNC40MzctMTIuMTY2LDQuNDM3IGMtMy4zMDgsMC03LjE4OC0wLjE0NC0xMS42NC0wLjQzbDAuNDc3LTkuMDY0bC0wLjQ3Ny0yMS44MDNMMzIuMjY5LDQ1LjgxNkwzMi4yNjksNDUuODE2eiBNMzEuNzkxLDcwLjE5NSBjMS40OTYsMCwyLjYzMy0wLjU5OCwzLjQxMi0xLjc4OWMwLjc3OS0xLjE5MywxLjE2OS0zLjE1NywxLjE2OS01Ljg5M2MwLTIuMzIxLTAuMTYtNC4xNS0wLjQ3Ny01LjQ4NiBjLTAuMzE5LTEuMzM2LTAuODI5LTIuMjk3LTEuNTI3LTIuODg1Yy0wLjctMC41ODktMS42Ny0wLjg4My0yLjkxLTAuODgzYy0xLjIwOSwwLTIuNDAyLDAuMDYzLTMuNTc5LDAuMTlsLTAuMzMzLDEzLjQwNiBsMC4wOTUsMi45NThDMjkuNTQ5LDcwLjA2OCwzMC45MzMsNzAuMTk1LDMxLjc5MSw3MC4xOTVMMzEuNzkxLDcwLjE5NXogTTc2LjgwNyw2Ni44MDhsMC4zODEsMTAuMDY2aC0xMC40bC04LjY4Mi0xNi41MDZoLTAuNTczIGwtMC4wNDcsNS4zNDJsMC4zODIsMTEuMTY0aC04LjY4M2wwLjQ3Ny05LjA2NGwtMC40NzctMjEuODAzaDEwLjRsOC42ODIsMTYuNTA3aDAuNTcybC0wLjI4NS0xNi4xNzJsOC43NzctMC41MjVMNzYuODA3LDY2LjgwOCBMNzYuODA3LDY2LjgwOHogTTk1LDQ1LjQzNWMzLjAyLDAsNi4wMTIsMC41NTYsOC45NjksMS42N2wtMS41MjcsNy43NzZsLTEuMzM2LDAuNTczYy0xLjMzNi0wLjgyOC0yLjY1Ni0xLjQ4LTMuOTU5LTEuOTU3IGMtMS4zMDMtMC40NzYtMi4zNTUtMC43MTYtMy4xNDgtMC43MTZjLTAuNzMyLDAtMS4zMTMsMC4xNDQtMS43NDIsMC40M3MtMC42NDUsMC42NjgtMC42NDUsMS4xNDZjMCwwLjYwNCwwLjMyOCwxLjEyMiwwLjk3OSwxLjU1IGMwLjY1LDAuNDI5LDEuNzM4LDEuMDAzLDMuMjY4LDEuNjkzYzEuNzc3LDAuODAzLDMuMjQ0LDEuNTM1LDQuMzkxLDIuMjE4YzEuMTQzLDAuNjgzLDIuMTQ2LDEuNjI0LDMuMDA0LDIuODE0IGMwLjg1NywxLjE5MiwxLjI4OSwyLjY2NCwxLjI4OSw0LjQxM2MwLDEuOTQtMC41MzMsMy42OTctMS42LDUuMjcyYy0xLjA2NCwxLjU3NC0yLjU4NCwyLjgyNC00LjU1NSwzLjc0NSBzLTQuMjYyLDEuMzgzLTYuODcxLDEuMzgzYy0zLjI0MiwwLTYuNjQ2LTAuNjA0LTEwLjIwOS0xLjgxM2wxLjM4NS04LjMwMmwwLjk1My0wLjU3MmMxLjQ2MywxLjExMywzLjAyOSwxLjk5Niw0LjY5OSwyLjY0NyBjMS42NywwLjY1MiwzLjA2MSwwLjk3OSw0LjE3NCwwLjk3OWMwLjg5MSwwLDEuNTM3LTAuMTUyLDEuOTM0LTAuNDUzYzAuMzk1LTAuMzAyLDAuNTk2LTAuNjc2LDAuNTk2LTEuMTIgYzAtMC42NjktMC4zNDItMS4yMzUtMS4wMjUtMS42OTRjLTAuNjg0LTAuNDYxLTEuNzkxLTEuMDI3LTMuMzE2LTEuNjkzYy0xLjc0OC0wLjc2NC0zLjE4OC0xLjQ4OC00LjMxNi0yLjE3MiBjLTEuMTMxLTAuNjgzLTIuMTA5LTEuNjIzLTIuOTM0LTIuODE0Yy0wLjgyNi0xLjE5Mi0xLjI0Mi0yLjY2NC0xLjI0Mi00LjQxM2MwLTIuMDA0LDAuNTQzLTMuODEsMS42MjMtNS40MTUgYzEuMDgtMS42MDUsMi41OTItMi44NzIsNC41MzEtMy43OTJDOTAuMzA3LDQ1Ljg5Nyw5Mi41MTgsNDUuNDM1LDk1LDQ1LjQzNUw5NSw0NS40MzV6IE0xMDYuNTIxLDk0Ljg5MUg4OS41MDggYy01LjE2Niw3LjQ4MS0xMi4xMjMsMTQuODctMjAuODQsMjIuMTY3YzEuMzY3LTAuMTY5LDIuNzE5LTAuMzg4LDQuMDU3LTAuNjU0YzMuNjQ2LTAuNzI5LDcuMTY0LTEuODE3LDEwLjU0OS0zLjI2NWwtMC4wMDItMC4wMDQgYzMuNDQxLTEuNDgsNi42NDYtMy4yMTIsOS42MDktNS4xOTljMi45NjktMS45OTIsNS43MjEtNC4yNTUsOC4yNS02Ljc5NWwwLjAxLTAuMDFsMCwwIEMxMDMuMDk4LDk5LjE4MiwxMDQuODkxLDk3LjEwMSwxMDYuNTIxLDk0Ljg5MUwxMDYuNTIxLDk0Ljg5MUwxMDYuNTIxLDk0Ljg5MXogTTU0LjIxLDExNy4wNTggYy04LjcxNi03LjI5Ny0xNS42NzMtMTQuNjg2LTIwLjgzOC0yMi4xNjdIMTYuMzYxYzEuNjMxLDIuMjEsMy40MjMsNC4yOTEsNS4zNzksNi4yNGwwLjAxLDAuMDExdi0wLjAwMSBjMi41MywyLjU0LDUuMjgyLDQuODA0LDguMjUsNi43OTVjMi45NjIsMS45ODcsNi4xNjcsMy43MTksOS42MSw1LjE5OWMwLjA0MiwwLjAxOSwwLjA4NSwwLjAzOSwwLjEyNywwLjA1OSBjMy4zNDUsMS40Miw2LjgxOSwyLjQ4OCwxMC40MiwzLjIwOUM1MS40OTMsMTE2LjY3LDUyLjg0MywxMTYuODg5LDU0LjIxLDExNy4wNThMNTQuMjEsMTE3LjA1OEw1NC4yMSwxMTcuMDU4eiBNMTYuMzYxLDI3Ljk5MSBoMTcuOTM4YzUuMTA4LTcuMzYxLDExLjg2Mi0xNC43NjUsMjAuMjktMjIuMjEyYy0xLjQ5NSwwLjE3NS0yLjk3MywwLjQwOS00LjQzMSwwLjdjLTMuNjQ3LDAuNzI5LTcuMTY0LDEuODE4LTEwLjU0OSwzLjI2NSBsMCwwLjAwM2MtMy40NDIsMS40ODEtNi42NDcsMy4yMTEtOS42MDksNS4yYy0yLjk2OSwxLjk5Mi01LjcyLDQuMjU1LTguMjUsNi43OTRMMjEuNzQsMjEuNzVsMCwwIEMxOS43ODQsMjMuNzAxLDE3Ljk5MiwyNS43OCwxNi4zNjEsMjcuOTkxTDE2LjM2MSwyNy45OTFMMTYuMzYxLDI3Ljk5MXogTTY4LjI5MSw1Ljc3OGM4LjQyOCw3LjQ0NywxNS4xODIsMTQuODUxLDIwLjI5MSwyMi4yMTIgaDE3LjkzOWMtMS42MzMtMi4yMS0zLjQyNi00LjI5Mi01LjM4My02LjI0MWwtMC4wMS0wLjAwOWwwLDBjLTIuNTI3LTIuNTQtNS4yNzktNC44MDItOC4yNS02Ljc5NCBjLTIuOTYzLTEuOTg4LTYuMTY4LTMuNzE5LTkuNjA5LTUuMmMtMC4wNDMtMC4wMTktMC4wODYtMC4wMzktMC4xMjctMC4wNTljLTMuMzQ2LTEuNDE4LTYuODItMi40ODgtMTAuNDItMy4yMDggQzcxLjI2Niw2LjE4Nyw2OS43ODUsNS45NTQsNjguMjkxLDUuNzc4TDY4LjI5MSw1Ljc3OEw2OC4yOTEsNS43Nzh6IE00OS4xMDcsMS4xOThDNTMuMDk5LDAuMzk5LDU3LjIxMSwwLDYxLjQ0LDAgczguMzQxLDAuMzk5LDEyLjMzMywxLjE5OGMzLjkzNiwwLjc4OCw3Ljc1OCwxLjk2OSwxMS40NzUsMy41NDdjMC4wNDksMC4wMTgsMC4xLDAuMDM4LDAuMTQ2LDAuMDU4IGMzLjcwMywxLjU5NCw3LjE5NywzLjQ4NSwxMC40NzMsNS42ODVjMy4yNjgsMi4xOTIsNi4yOTEsNC42NzcsOS4wNjQsNy40NjFjMi43ODUsMi43NzUsNS4yNzEsNS43OTksNy40NjMsOS4wNjUgYzIuMTk3LDMuMjc1LDQuMDksNi43NjksNS42ODQsMTAuNDc0bC0wLjAwNCwwLjAwMWwwLjAwNCwwLjAwOWMxLjYwNywzLjc1OCwyLjgwOSw3LjYyNywzLjYwNSwxMS42MDkgYzAuNzk5LDMuOTkyLDEuMTk1LDguMTA0LDEuMTk1LDEyLjMzNGMwLDQuMjI5LTAuMzk2LDguMzQzLTEuMTk1LDEyLjMzNWMtMC43ODcsMy45MzItMS45NzMsNy43NTgtMy41NDcsMTEuNDcyIGMtMC4wMiwwLjA1LTAuMDM3LDAuMDk5LTAuMDYxLDAuMTQ3Yy0xLjU5NCwzLjcwNS0zLjQ4NCw3LjE5Ni01LjY4NCwxMC40NzJjLTIuMTkxLDMuMjY4LTQuNjc2LDYuMjktNy40NjEsOS4wNjUgYy0yLjc3NSwyLjc4NS01Ljc5OSw1LjI3MS05LjA2Niw3LjQ2MmMtMy4yNzMsMi4xOTgtNi43NjgsNC4wOTEtMTAuNDcxLDUuNjg0bC0wLjAwMi0wLjAwNGwtMC4wMSwwLjAwNCBjLTMuNzU4LDEuNjA2LTcuNjI5LDIuODA5LTExLjYwOSwzLjYwNGMtMy45OTIsMC44LTguMTA1LDEuMTk4LTEyLjMzMywxLjE5OGMtNC4yMjksMC04LjM0My0wLjM5OC0xMi4zMzQtMS4xOTggYy0zLjkzMy0wLjc4Ny03Ljc1OC0xLjk3LTExLjQ3NC0zLjU0NmMtMC4wNDktMC4wMTktMC4wOTgtMC4wMzctMC4xNDctMC4wNmMtMy43MDUtMS41OTMtNy4xOTctMy40ODQtMTAuNDcyLTUuNjg0IGMtMy4yNjYtMi4xOS02LjI5MS00LjY3Ny05LjA2NS03LjQ2MmMtMi43ODUtMi43NzUtNS4yNy01Ljc5OS03LjQ2MS05LjA2NGMtMi4xOTgtMy4yNzQtNC4wOS02Ljc2OC01LjY4NC0xMC40NzNsMC4wMDQtMC4wMDIgbC0wLjAwNC0wLjAwOWMtMS42MDYtMy43NTgtMi44MDgtNy42MjgtMy42MDQtMTEuNjA5QzAuNCw2OS43ODMsMCw2NS42NzEsMCw2MS40NGMwLTQuMjI5LDAuNC04LjM0MiwxLjE5OC0xMi4zMzQgYzAuNzg3LTMuOTMzLDEuOTctNy43NTcsMy41NDYtMTEuNDczYzAuMDE5LTAuMDQ5LDAuMDM4LTAuMSwwLjA1OC0wLjE0N2MxLjU5NC0zLjcwNSwzLjQ4NS03LjE5OCw1LjY4NC0xMC40NzQgYzIuMTkyLTMuMjY2LDQuNjc3LTYuMjksNy40NjEtOS4wNjVjMi43NzQtMi43ODUsNS43OTktNS4yNyw5LjA2NS03LjQ2MWMzLjI3NS0yLjE5OSw2Ljc2OS00LjA5LDEwLjQ3Mi01LjY4NWwwLjAwMSwwLjAwNCBsMC4wMDktMC4wMDRDNDEuMjU1LDMuMTk3LDQ1LjEyNiwxLjk5NSw0OS4xMDcsMS4xOThMNDkuMTA3LDEuMTk4TDQ5LjEwNywxLjE5OHogTTY0LjEzNSw5LjI2OHYxOC43MjNoMTcuODI2IEM3Ny4yNzUsMjEuODE1LDcxLjM0LDE1LjU3NSw2NC4xMzUsOS4yNjhMNjQuMTM1LDkuMjY4TDY0LjEzNSw5LjI2OHogTTY0LjEzNSw5NC44OTF2MTguOTUyIGM3LjY0NS02LjI4MywxMy45LTEyLjYwMSwxOC43NDYtMTguOTUySDY0LjEzNUw2NC4xMzUsOTQuODkxTDY0LjEzNSw5NC44OTF6IE01OC43NDgsMTEzLjg0NVY5NC44OTFINDAgQzQ0Ljg0MywxMDEuMjQxLDUxLjEwMSwxMDcuNTYyLDU4Ljc0OCwxMTMuODQ1TDU4Ljc0OCwxMTMuODQ1TDU4Ljc0OCwxMTMuODQ1eiBNNTguNzQ4LDI3Ljk5MVY5LjI2NiBjLTcuMjA3LDYuMzA3LTEzLjE0MywxMi41NDktMTcuODI3LDE4LjcyNUg1OC43NDhMNTguNzQ4LDI3Ljk5MUw1OC43NDgsMjcuOTkxeiIvPjwvZz48L3N2Zz4="
    camel.apache.org/provider: "Apache Software Foundation"
    camel.apache.org/kamelet.group: "DNS"
  labels:
    camel.apache.org/kamelet.type: "action"
spec:
  definition:
    title: "DNS DIG Action"
    description: |-
      Query a DNS through Dig

      The Kamelet expects the following headers to be set:

      - `domain-name` / `ce-domainname`: as the domain for which we are querying the DNS

      - `dns-type` / `ce-dnstype`: as the DNS type

      If the domain-name header won't be set the body will be used as domain name.

      If the dns-type header won't be set, the DNS Type A will be used.
    type: object
  dependencies:
    - "camel:core"
    - "camel:dns"
    - "camel:kamelet"
  template:
    from:
      uri: "kamelet:source"
      steps:
      - choice:
          when:
          - simple: "${header[domain-name]}"
            steps:
            - set-header:
                name: dns.name
                simple: "${header[domain-name]}"
          - simple: "${header[ce-domainname]}"
            steps:
            - set-header:
                name: dns.name
                simple: "${header[ce-domainname]}"
          otherwise:
            steps:
            - set-header:
                name: dns.name
                simple: "${body}"
      - choice:
          when:
          - simple: "${header[dns-type]}"
            steps:
            - set-header:
                name: dns.type
                simple: "${header[dns-type]}"
          - simple: "${header[ce-dnstype]}"
            steps:
            - set-header:
                name: dns.type
                simple: "${header[ce-dnstype]}"
          otherwise:
            steps:
            - set-header:
                name: dns.type
                constant: "A"
      - to:
          uri: "dns:dig"
      - convert-body-to:
          type: "java.lang.String"
